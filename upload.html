<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlueMoss Galaxy Album</title>
    <style>
        /* --- C·∫§U H√åNH CHUNG --- */
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #0f172a; /* M√†u n·ªÅn t·ªëi hi·ªán ƒë·∫°i */
            color: white;
            margin: 0; padding: 20px;
            min-height: 100vh;
        }

        h1 { text-align: center; color: #4ecca3; margin-top: 0; text-transform: uppercase; letter-spacing: 2px; }

        /* --- PH·∫¶N HI·ªÇN TH·ªä ·∫¢NH (GALLERY) --- */
        #gallery {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* 5 ·∫£nh 1 h√†ng */
            gap: 10px;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding-bottom: 80px; /* Tr√°nh b·ªã n√∫t (+) che m·∫•t */
        }

        .image-card {
            aspect-ratio: 1; /* Lu√¥n vu√¥ng */
            overflow: hidden;
            border-radius: 8px;
            background: #1e293b;
            border: 1px solid #334155;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .image-card:hover { transform: scale(1.05); z-index: 10; border-color: #4ecca3; }

        .image-card img {
            width: 100%; height: 100%; object-fit: cover;
            transition: opacity 0.3s;
        }

        /* Responsive cho ƒëi·ªán tho·∫°i (2 ·∫£nh 1 h√†ng) */
        @media (max-width: 768px) {
            #gallery { grid-template-columns: repeat(2, 1fr); }
        }

        /* --- N√öT D·∫§U C·ªòNG (+) --- */
        .fab-btn {
            position: fixed;
            bottom: 30px; right: 30px;
            width: 60px; height: 60px;
            background: linear-gradient(135deg, #e94560, #533483);
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 30px;
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.5);
            cursor: pointer;
            z-index: 100;
            display: flex; align-items: center; justify-content: center;
            transition: transform 0.2s;
        }
        .fab-btn:hover { transform: scale(1.1) rotate(90deg); }

        /* --- POPUP (MODAL) UPLOAD --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 200;
            display: none; /* M·∫∑c ƒë·ªãnh ·∫©n */
            justify-content: center; align-items: center;
            opacity: 0; transition: opacity 0.3s;
        }
        .modal-overlay.active { display: flex; opacity: 1; }

        .upload-box {
            background: #1e293b;
            padding: 30px; border-radius: 20px;
            width: 90%; max-width: 450px;
            text-align: center;
            border: 1px solid #475569;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            position: relative;
        }

        .close-btn {
            position: absolute; top: 10px; right: 15px;
            font-size: 24px; cursor: pointer; color: #94a3b8;
        }
        .close-btn:hover { color: white; }

        /* Style n√∫t upload c≈© */
        input[type="file"] { display: none; }
        .custom-file-upload {
            border: 2px dashed #4ecca3; display: block;
            padding: 20px; cursor: pointer; border-radius: 10px;
            color: #4ecca3; margin-bottom: 20px;
            background: rgba(78, 204, 163, 0.1);
        }
        .btn-action {
            background: #4ecca3; border: none; padding: 12px 30px;
            color: #0f172a; border-radius: 25px; font-weight: bold;
            cursor: pointer; width: 100%; font-size: 16px;
        }
        .btn-action:disabled { background: gray; cursor: not-allowed; }

        .loading-text { margin-top: 10px; font-size: 0.9em; color: yellow; }
    </style>
</head>
<body>

    <h1>üåå BlueMoss Gallery</h1>

    <div id="gallery">
        <div style="grid-column: 1/-1; text-align: center; color: #64748b; padding-top: 50px;">
            ƒêang t·∫£i ·∫£nh t·ª´ v≈© tr·ª• v·ªÅ... üõ∏
        </div>
    </div>

    <button class="fab-btn" onclick="toggleModal(true)">+</button>

    <div class="modal-overlay" id="uploadModal">
        <div class="upload-box">
            <span class="close-btn" onclick="toggleModal(false)">&times;</span>
            <h2 style="margin-top: 0;">Th√™m ·∫¢nh M·ªõi</h2>
            
            <label for="file-input" class="custom-file-upload">
                üìÇ Ch·ªçn ·∫£nh t·ª´ m√°y
            </label>
            <input id="file-input" type="file" multiple accept="image/*" onchange="previewFiles()">
            
            <div id="file-count" style="margin-bottom: 15px; color: #ccc;">Ch∆∞a ch·ªçn ·∫£nh</div>
            
            <button id="btn-upload" class="btn-action" onclick="uploadFiles()">üöÄ T·∫£i L√™n</button>
            <div id="status" class="loading-text"></div>
        </div>
    </div>

    <script>
        // ================= C·∫§U H√åNH =================
        const cloudName = "djerotwoc"; 
        const uploadPreset = "my_upload"; 
        const albumTag = "galaxy_album"; // Tag d√πng ƒë·ªÉ l·ªçc ·∫£nh c·ªßa trang n√†y
        // ============================================

        // 1. H√ÄM LOAD ·∫¢NH T·ª™ CLOUD V·ªÄ (Ch·∫°y ngay khi m·ªü web)
        async function loadGallery() {
            const gallery = document.getElementById('gallery');
            
            // URL ƒë·∫∑c bi·ªát ƒë·ªÉ l·∫•y danh s√°ch ·∫£nh theo Tag (JSON)
            // Y√™u c·∫ßu: ƒê√£ b·∫≠t "Resource list" trong Settings
            const listUrl = `https://res.cloudinary.com/${cloudName}/image/list/${albumTag}.json`;

            try {
                const response = await fetch(listUrl);
                if (!response.ok) throw new Error("Ch∆∞a c√≥ ·∫£nh ho·∫∑c ch∆∞a b·∫≠t List Resource");
                
                const data = await response.json();
                const resources = data.resources;

                gallery.innerHTML = ""; // X√≥a ch·ªØ "ƒêang t·∫£i..."

                if (resources.length === 0) {
                    gallery.innerHTML = `<div style="grid-column: 1/-1; text-align: center;">Ch∆∞a c√≥ ·∫£nh n√†o. H√£y b·∫•m d·∫•u + ƒë·ªÉ th√™m!</div>`;
                    return;
                }

                // Duy·ªát qua danh s√°ch v√† t·∫°o th·∫ª img
                resources.forEach(res => {
                    const imgUrl = `https://res.cloudinary.com/${cloudName}/image/upload/c_fill,w_300,h_300/${res.public_id}.${res.format}`;
                    
                    const div = document.createElement('div');
                    div.className = 'image-card';
                    // Th√™m s·ª± ki·ªán click ƒë·ªÉ xem ·∫£nh to (n·∫øu mu·ªën m·ªü r·ªông sau n√†y)
                    div.onclick = () => window.open(`https://res.cloudinary.com/${cloudName}/image/upload/${res.public_id}.${res.format}`, '_blank');
                    
                    div.innerHTML = `<img src="${imgUrl}" alt="Galaxy Image" loading="lazy">`;
                    gallery.prepend(div); // ·∫¢nh m·ªõi nh·∫•t l√™n ƒë·∫ßu
                });

            } catch (error) {
                console.log("L·ªói load gallery:", error);
                // N·∫øu l·ªói (th∆∞·ªùng do ch∆∞a c√≥ ·∫£nh n√†o tag l√† galaxy_album), c·ª© ƒë·ªÉ tr·ªëng ho·∫∑c hi·ªán th√¥ng b√°o nh·∫π
                gallery.innerHTML = `<div style="grid-column: 1/-1; text-align: center; color: #64748b;">
                    Kho ·∫£nh ƒëang tr·ªëng ho·∫∑c ch∆∞a b·∫≠t ch·∫ø ƒë·ªô Public List.<br>
                    B√°c c·ª© b·∫•m (+) ƒë·ªÉ up th·ª≠ c√°i ƒë·∫ßu ti√™n nh√©!
                </div>`;
            }
        }

        // 2. H√ÄM UPLOAD (ƒê√£ s·ª≠a ƒë·ªÉ th√™m Tag v√† reload l·∫°i trang)
        async function uploadFiles() {
            const input = document.getElementById('file-input');
            const status = document.getElementById('status');
            const btn = document.getElementById('btn-upload');
            const files = input.files;

            if (files.length === 0) { alert("Ch∆∞a ch·ªçn ·∫£nh!"); return; }

            btn.disabled = true;
            btn.innerText = "ƒêang t·∫£i l√™n... ‚è≥";

            let successCount = 0;

            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                status.innerText = `ƒêang x·ª≠ l√Ω: ${file.name}`;
                
                const formData = new FormData();
                formData.append("file", file);
                formData.append("upload_preset", uploadPreset);
                formData.append("tags", albumTag); // <--- QUAN TR·ªåNG: G·∫Øn th·∫ª ƒë·ªÉ loadGallery t√¨m th·∫•y

                try {
                    const res = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/image/upload`, {
                        method: "POST",
                        body: formData
                    });
                    if (res.ok) successCount++;
                } catch (err) {
                    console.error("L·ªói file:", file.name);
                }
            }

            // X·ª≠ l√Ω sau khi up xong
            status.innerText = `üéâ ƒê√£ xong ${successCount} ·∫£nh!`;
            setTimeout(() => {
                toggleModal(false); // ƒê√≥ng popup
                loadGallery();      // Load l·∫°i danh s√°ch ·∫£nh
                
                // Reset form
                btn.disabled = false;
                btn.innerText = "üöÄ T·∫£i L√™n";
                status.innerText = "";
                input.value = "";
                document.getElementById('file-count').innerText = "Ch∆∞a ch·ªçn ·∫£nh";
            }, 1000);
        }

        // 3. C√ÅC H√ÄM PH·ª§ TR·ª¢ (Popup, ƒë·∫øm file)
        function toggleModal(show) {
            const modal = document.getElementById('uploadModal');
            if (show) modal.classList.add('active');
            else modal.classList.remove('active');
        }

        function previewFiles() {
            const input = document.getElementById('file-input');
            const count = document.getElementById('file-count');
            if(input.files.length > 0) {
                count.innerText = `ƒê√£ ch·ªçn ${input.files.length} file`;
                count.style.color = "#4ecca3";
            }
        }

        // Ch·∫°y h√†m load ·∫£nh ngay khi v√†o web
        window.onload = loadGallery;

    </script>
</body>
</html>